AUI().add("liferay-portlet-journal",function(l){var i=l.DataType;var g=l.Lang;var h=function(){var u="";var t=Liferay.Portlet.Journal.PROXY.instanceIdKey;for(var s=0;s<8;s++){var v=Math.floor(Math.random()*t.length);u+=t.substring(v,v+1)}return u};var k=function(){return(++l.Env._uidx)};var q='<div><li class="structure-field"><span class="journal-article-close"></span><span class="folder"><div class="field-container"><input class="journal-article-localized" type="hidden" value="false" /><div class="journal-article-move-handler"></div><label for="" class="journal-article-field-label"><span>{fieldLabel}</span></label><div class="journal-article-component-container"></div><span class="aui-field aui-field-choice journal-article-localized-checkbox"><span class="aui-field-content"><span class="aui-field-element aui-field-label-right"><input type="hidden" value="false" name="{portletNamespace}{instanceId}localized-checkbox"><input type="checkbox" onclick="Liferay.Util.updateCheckboxValue(this); " name="{portletNamespace}{instanceId}localized-checkboxCheckbox" id="{portletNamespace}{instanceId}localized-checkboxCheckbox" class="aui-field-input aui-field-input-choice"> </span><label for="{portletNamespace}{instanceId}localized-checkboxCheckbox" class="aui-field-label">{localizedLabelLanguage}</label></span></span><div class="journal-article-required-message portlet-msg-error">{requiredFieldLanguage}</div><div class="journal-article-buttons {articleButtonsRowCSSClass}"><span class="aui-field aui-field-inline aui-field-text journal-article-variable-name"><span class="aui-field-content"><label for="{portletNamespace}{instanceId}variableName" class="aui-field-label">{variableNameLanguage}</label><span class="aui-field-element "><input type="text" size="25" value="{variableName}" name="{portletNamespace}variableName" id="{portletNamespace}{instanceId}variableName" class="aui-field-input aui-field-input-text"></span></span></span>{editBtnTemplateHTML}{repeatableBtnTemplateHTML}</div></div><ul class="folder-droppable"></ul></span></li></div>';var n='<div id="{0}" class="journal-article-helper not-intersecting"><div class="journal-component"></div><div class="forbidden-action"></div></div>';var b='<iframe frameborder="0" height="460" id="{name}" name="{name}" scrolling="no" src="{url}" width="500"></iframe>';var e='<div class="journal-article-instructions-container journal-article-instructions-message portlet-msg-info"></div>';var m="<option></option>";var r='<div class="aui-tree-placeholder aui-tree-sub-placeholder"></div>';var o='<input class="aui-field-input lfr-input-text" type="text" value="" size="40"/>';var c='<img align="top" class="journal-article-instructions-container" src="'+themeDisplay.getPathThemeImages()+'/portlet/help.png" />';var j=new l.DataSet();var a=function(u,t){var D=this;D.articleId=t;D.timers={};D.portletNamespace=u;var v=D._getNamespacedId("#structureTree");var A=l.one(v);D._helperId=D._getNamespacedId("journalArticleHelper",D.portletNamespace,"");var w=l.substitute(n,[D._helperId]);D._helper=l.Node.create(w);D._helper.appendTo(document.body);D.acceptChildren=true;var B=l.Node.create(r);var z=l.all(v+" li.structure-field");D.nestedListOptions={dd:{handles:[".journal-article-move-handler"]},dropCondition:function(F){var E=F.drop.get("node");return D.canDrop(E)},dropOn:"span.folder > ul.folder-droppable",helper:D._helper,placeholder:B,sortCondition:function(F){var E=F.drop.get("node");return E.ancestor(v)},sortOn:v};D.nestedListEvents={"drag:start":function(F){var E=D._helper;E.setStyle("height","100px");E.setStyle("width","450px");D.updateTextAreaVisibility("hidden")},"drag:end":function(E){D._dropField();D.updateTextAreaVisibility("visible")},"drag:out":function(E){if(!D.acceptChildren){D.helperIntersecting();D.acceptChildren=true}},"drag:over":function(F){var E=F.drop.get("node");D.acceptChildren=D.canDrop(E);if(D.acceptChildren){D.helperIntersecting()}else{D.helperNotIntersecting()}}};D.createNestedList(z.filter(":not(.repeated-field)").filter(":not(.parent-structure-field)"),D.nestedListOptions,D.nestedListEvents);var x=D._getNamespacedId("#journalComponentList");var y=l.all(x+" .component-group .journal-component");D.componentFieldsOptions={dropCondition:function(F){var E=F.drop.get("node");return D.canDrop(E)},dropOn:"span.folder > ul.folder-droppable",helper:D._helper,placeholder:B,sortCondition:function(F){var E=F.drop.get("node");return E.ancestor(v)}};D.componentFieldsEvents={"drag:start":function(F){var I=F.target;var K=I.get("dragNode");var E=I.get("node");var M=E.text();var H=D.getComponentType(E);var J="journal-component-"+D._stripComponentType(H);var G=D._helper;var L=D._helper.all("div.journal-component");G.setStyle("height","25px");G.setStyle("width","200px");if(L){L.addClass(J).html(M)}K.addClass("component-dragging");D.updateTextAreaVisibility("hidden");D.clonedSource=E.clone();E.placeBefore(D.clonedSource);D.clonedSource.attr("id","");D.clonedSource.guid();D.clonedSource.show().setStyle("visibility","visible");D.clonedSource.removeClass("aui-helper-hidden");D.clonedSource.addClass("dragging");D.createNestedList(D.clonedSource,D.componentFieldsOptions,D.componentFieldsEvents,true)},"drag:end":function(F){var M=F.target;var E=M.get("node");var O=M.get("dragNode");var I=D.getComponentType(E);var N="journal-component-"+D._stripComponentType(I);var Q=D._helper.all("div.journal-component");O.removeClass("component-dragging");if(Q){Q.removeClass(N).empty()}var K=A.one("div.journal-component");if(K){K.hide();var U=D._fieldInstanceFactory(I);if(U.get("fieldType")=="text_area"){var L=D.buildHTMLEditor(U);U.set("innerHTML",L)}var R=D._createFieldHTMLTemplate(U);var P=l.Node.create(R);K.placeBefore(P);K.remove();var S=P.attr("dataName");var H=P.attr("dataInstanceId");U.set("source",P);U.set("variableName",S);U.set("instanceId",H);D.createNestedList(P,D.nestedListOptions,D.nestedListEvents);D._attachEvents();var G=P.get("id");j.add(G,U);D.repositionEditFieldOptions();var J=D.getById(H+"variableName");if(J){Liferay.Util.focusFormField(J);J.select()}}else{E.remove()}D.updateTextAreaVisibility("visible");if(D.clonedSource){var T=D.getById("#journalComponentList");D.clonedSource.removeClass("dragging");if(T.contains(E[0])&&T.contains(D.clonedSource[0])){E.remove()}}},"drag:out":D.nestedListEvents["drag:out"],"drag:over":D.nestedListEvents["drag:over"]};D.createNestedList(y,D.componentFieldsOptions,D.componentFieldsEvents,true);var s=D.getById("fieldLabel");var C=D.getById("#journalArticleEditFieldWrapper");C.show();D.editContainerContextPanel=new l.OverlayContextPanel({after:{hide:l.bind(D.closeEditFieldOptions,D),show:function(){l.later(0,D,function(){Liferay.Util.focusFormField(s)})}},align:{points:["lc","rc"]},bodyContent:C,trigger:".edit-button .aui-button-input"}).render();l.OverlayContextManager.remove(D.editContainerContextPanel);D._initializeTagsSuggestionContent();D._initializePageLoadFieldInstances();D._attachEvents();D._attachEditContainerEvents();D._attachDelegatedEvents();D._updateOriginalStructureXSD()};a.prototype={addStructure:function(x,v,u,B,A,D){var C=this;var w=C.getGroupId();var t=true;var z=true;var s="";var y=["long","java.lang.String","boolean","java.lang.String","java.lang.String","java.lang.String","java.lang.String","com.liferay.portal.service.ServiceContext"];Liferay.Service.Journal.JournalStructure.addStructure({groupId:w,structureId:x,autoStructureId:v,parentStructureId:s,name:u,description:B,xsd:A,serviceContext:l.JSON.stringify({addCommunityPermissions:t,addGuestPermissions:z,scopeGroupId:w}),serviceParameterTypes:l.JSON.stringify(y)},function(E){if(g.isFunction(D)){D(E)}})},articleChanged:function(){var s=this;return window[s.portletNamespace+"contentChangedFlag"]},buildHTMLEditor:function(t){var s=this;var w=t.get("instanceId");var v=s.portletNamespace+"structure_el_"+w+"_content";var u=s.buildHTMLEditorURL(t);var x=l.substitute(b,{name:v,url:u});return x},buildHTMLEditorURL:function(u){var t=this;var v=[];var s=t.portletNamespace+"initEditor"+u.get("variableName");var w=t.portletNamespace+"editorContentChanged";window[s]=t._emptyFunction;v.push(themeDisplay.getPathContext());v.push("/html/js/editor/editor.jsp?p_l_id=");v.push(themeDisplay.getPlid());v.push("&p_main_path=");v.push(encodeURIComponent(themeDisplay.getPathMain()));v.push("&doAsUserId=");v.push(a.PROXY.doAsUserId);v.push("&editorImpl=");v.push(a.PROXY.editorImpl);v.push("&toolbarSet=liferay-article");v.push("&initMethod=");v.push(s);v.push("&onChangeMethod=");v.push(w);v.push("&cssPath=");v.push(a.PROXY.pathThemeCss);v.push("&cssClasses=portlet ");return v.join("")},canDrop:function(u){var s=this;var t=s.getComponentType(u);var v=true;if((t=="multi-list")||(t=="list")){v=false}else{if(u.hasClass("repeated-field")||u.hasClass("parent-structure-field")){v=false}}return v},changeLanguageView:function(){var B=this;var s=B.getPrincipalForm();var D=B.getArticleContentXML();var v=B.getByName(s,"cmd");var y=B.getByName(s,"content");var C=B.getByName(s,"languageId");var z=B.getByName(s,"lastLanguageId");var A=B.getByName(s,"redirect");v.val("");if(B.articleChanged()){if(confirm(Liferay.Language.get("would-you-like-to-save-the-changes-made-to-this-language"))){v.val("update");y.val(D)}else{if(!confirm(Liferay.Language.get("are-you-sure-you-want-to-switch-the-languages-view"))){C.val(z.val());return}else{y.val("")}}}else{y.val("")}var u=B.getByName(s,"workflowAction");u.val(Liferay.Workflow.STATUS_ANY);var t=C.val();var w=window[B.portletNamespace+"getLanguageViewURL"];var x=w(t);A.val(x);s.submit()},clearMessage:function(t){var s=this;var u=l.one(t);var v=s.timers[t];if(v){v.cancel()}u.hide()},closeEditFieldOptions:function(){var s=this;s.editContainerContextPanel.hide();s.unselectFields()},closeField:function(u){var t=this;var s=t.getFields();if(s&&s.size()>1){if(confirm(Liferay.Language.get("are-you-sure-you-want-to-delete-this-field-and-all-its-children"))){t.closeRepeatedSiblings(u);t.closeEditFieldOptions();if(u.inDoc()){u.remove()}}}},closeRepeatedSiblings:function(v){var s=this;var t=s.getFieldInstance(v);if(!t.get("repeated")){var u=s.getRepeatedSiblings(t);if(u){u.remove()}}},createNestedList:function(u,v,w,x){var s=this;var t=function(z){l.each(w,function(B,A,C){if(A&&g.isFunction(B)){z.on(A,B)}})};var y={dropOn:".folder"};v=l.merge(y,v);if(!s._nestedList){s._nestedList=new l.NestedList(v);t(s._nestedList)}if(x&&!s._nestedListComponents){s._nestedListComponents=new l.NestedList(v);t(s._nestedListComponents)}u.each(function(A,z,C){var B=s._nestedList;if(x){B=s._nestedListComponents}B.add(A)})},disableEditMode:function(){var s=this;l.getBody().removeClass("portlet-journal-edit-mode");var u=s.getById("editStructureBtn");var t=s.getById("#journalComponentList");var v=s.getById("saveStructureBtn");s.closeEditFieldOptions();v.ancestor(".aui-button").hide();t.hide();var w=Liferay.Language.get("edit");u.val(w);l.all("input.journal-list-label").attr("disabled","disabled");if(s.structureChange()){var x=s.getById("structureMessage");s.showMessage(x,"alert",null,30000)}},disableFields:function(){var s=this;var t=s.getById("#journalArticleContainer");t.all("input:not(:button)").attr("disabled","disabled");t.all("textarea, select").attr("disabled","disabled")},downloadArticleContent:function(){var s=this;var v=themeDisplay.getPathMain()+"/journal/get_article_content";var u=s.getPrincipalForm("fm2");var t=s.getArticleContentXML();var w=s.getByName(u,"xml",true);if(s.structureChange()){if(confirm(Liferay.Language.get("you-should-save-the-structure-first"))){s.openSaveStructureDialog()}}else{u.attr("action",v);u.attr("target","_self");w.val(t);u.submit()}},editContainerNormalMode:function(){var s=this;var t=s.getById("#journalArticleEditFieldWrapper");t.removeClass("save-mode");s.editContainerModified=false},editContainerSaveMode:function(){var s=this;var t=s.getById("#journalArticleEditFieldWrapper");t.addClass("save-mode");s.editContainerModified=true},enableEditMode:function(){var s=this;l.getBody().addClass("portlet-journal-edit-mode");var u=s.getById("editStructureBtn");var t=s.getById("#journalComponentList");var w=s.getById("saveStructureBtn");s.editContainerNormalMode();w.ancestor(".aui-button").show();t.show();var v=s.getById("#structureTree");var x=Liferay.Language.get("stop-editing");u.val(x);v.all(".journal-list-label").attr("disabled","");var y=s.getById("structureMessage");s.clearMessage(y)},enableFields:function(){var s=this;var t=s.getById("#journalArticleContainer");t.all("input:not(:button)").attr("disabled","");t.all("textarea, select").attr("disabled","")},getArticleContentXML:function(){var A=this;var w=[];var t=A._getNamespacedId("#structureTree");var B=l.all(t+" > li");var u=A.hasStructure();var x;if(!u){var D=B.item(0);if(D){var E=A.getFieldInstance(D);x=E.getContent(D)}}else{var v=null;var z=[];var F=false;var s=l.all("[name="+A.portletNamespace+"available_locales]");var C=A.getById("defaultLocale").val();A.getFields().each(function(J,H,K){var G=A.getFieldInstance(J);var I=G.get("localized");if(I){F=true}});if(F){s.each(function(I,H,J){var G=I.val();if(G){z.push(G)}});v={"available-locales":z.join(","),"default-locale":C}}var y=A._createDynamicNode("root",v);w.push(y.openTag);B.each(function(H,G,I){A._appendStructureTypeElementAndMetaData(H,w,true)});w.push(y.closeTag);x=w.join("")}return x},getById:function(u,t){var s=this;return l.one(s._getNamespacedId(u,t))},getByName:function(w,u,v){var s=this;var t=v?u:s.portletNamespace+u;return l.one(w).one("[name="+t+"]")},getCloseButtons:function(){var s=this;return l.all("span.journal-article-close")},getComponentType:function(s){return s.attr("dataType")},getDefaultLocale:function(){var s=this;return s.getById("defaultLocale").val()},getEditButton:function(t){var s=this;return t.one(".edit-button .aui-button-input")},getEditButtons:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" div.journal-article-buttons .edit-button .aui-button-input")},getFieldInstance:function(t){var s=this;var u=t.get("id");return j.item(u)},getFields:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" li")},getGroupId:function(){var s=this;var t=themeDisplay.getScopeGroupId();if(s.articleId){var u=s.getPrincipalForm();var w=s.getByName(u,"groupId");var v=w.val();if(v){t=v}}return t},getParentStructureId:function(){var s=this;return s.getById("parentStructureId").val()},getRepeatableButtons:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" div.journal-article-buttons .repeatable-button .aui-button-input")},getRepeatedSiblings:function(u){var t=this;var v=t._getNamespacedId("#structureTree");var s=v+" li[dataName="+u.get("variableName")+"].repeated-field";return l.all(s)},getSaveDialog:function(E){var D=this;if(!D._saveDialog){var u=D.getById("saveStructureTemplateDialog");var A=u.html();var B=Liferay.Language.get("editing-structure-details");var t=D.getPrincipalForm();var C=D.getByName(t,"structureId");var z=D.getByName(t,"structureName");var x=D.getByName(t,"structureDescription");var s=D.getByName(t,"structureXSD");var v=function(){var H=D._saveDialog.fields;D.showMessage(H.messageElement,"info",Liferay.Language.get("waiting-for-an-answer"));var J=D.getPrincipalForm();var G=D.getByName(J,"structureId");var I=G.val();if(!I){var F=H.saveStructureAutogenerateIdCheckbox.get("checked");D.addStructure(H.dialogStructureId.val(),F,H.dialogStructureName.val(),H.dialogDescription.val(),H.contentXSD,y)}else{D.updateStructure(D.getParentStructureId(),H.dialogStructureId.val(),H.dialogStructureName.val(),H.dialogDescription.val(),H.contentXSD,y)}};D._saveDialog=new l.Dialog({bodyContent:A,buttons:[{handler:v,text:Liferay.Language.get("save")},{handler:function(){this.close()},text:Liferay.Language.get("cancel")}],centered:true,modal:true,title:B,width:550}).render();D._saveDialog.fields={autoGenerateIdMessage:Liferay.Language.get("autogenerate-id"),contentXSD:"",dialogDescription:D.getById("saveStructureStructureDescription"),dialogStructureId:D.getById("saveStructureStructureId"),dialogStructureName:D.getById("saveStructureStructureName"),idInput:D.getById("saveStructureStructureId"),loadDefaultStructure:D.getById("loadDefaultStructure"),messageElement:D.getById("saveStructureMessage"),saveStructureAutogenerateId:D.getById("saveStructureAutogenerateId"),saveStructureAutogenerateIdCheckbox:D.getById("saveStructureAutogenerateIdCheckbox"),showStructureIdContainer:D.getById("showStructureIdContainer"),structureIdContainer:D.getById("structureIdContainer"),structureNameLabel:D.getById("structureNameLabel")};var w=D._saveDialog.fields;var y=function(H){var G=H.exception;if(!G){x.val(H.description);C.val(H.structureId);z.val(H.name);s.val(encodeURIComponent(w.contentXSD));w.dialogStructureId.val(H.structureId);w.dialogStructureName.val(H.name);w.dialogDescription.val(H.description);w.structureNameLabel.html(H.name);w.saveStructureAutogenerateIdCheckbox.hide();if(w.loadDefaultStructure){w.loadDefaultStructure.show()}w.dialogStructureId.attr("disabled","disabled");D.showMessage(w.messageElement,"success",Liferay.Language.get("your-request-processed-successfully"));var I=D.getById("structureMessage");I.hide()}else{var F=D._translateErrorMessage(G);D.showMessage(w.messageElement,"error",F)}};w.saveStructureAutogenerateIdCheckbox.on("click",function(F){var H=F.target;var G=H.get("checked");w.saveStructureAutogenerateId.val(G);if(G){w.dialogStructureId.attr("disabled","disabled").val(w.autoGenerateIdMessage)}else{w.dialogStructureId.attr("disabled","").val("")}});w.showStructureIdContainer.on("click",function(F){w.structureIdContainer.toggle();F.halt()});w.dialogStructureName.focus()}else{D._saveDialog.show()}if(E){E.apply(D,[D._saveDialog])}},getSelectedField:function(){var t=this;var u=null;var s=t.getFields();if(s){u=s.filter(".selected")}return u?u.item(0):null},getSourceByNode:function(t){var s=this;return t.ancestor("li",true)},getStructureXSD:function(){var s=this;var u=[];var w=s._getNamespacedId("#structureTree");var v=l.all(w+" > li.structure-field:not(.repeated-field)").filter(":not(.parent-structure-field)");var t=s._createDynamicNode("root");u.push(t.openTag);l.each(v,function(y,x,z){s._appendStructureTypeElementAndMetaData(y,u)});u.push(t.closeTag);return u.join("")},getTextAreaFields:function(){var s=this;var t=s._getNamespacedId("#structureTree");return l.all(t+" li[dataType=text_area] div.journal-article-component-container")},getPrincipalFieldElement:function(u){var s=this;var t=u.one("div.journal-article-component-container");return t.one(".aui-field-input")},getPrincipalForm:function(t){var s=this;return l.one("form[name="+s.portletNamespace+(t||"fm1")+"]")},getNodeTypeContent:function(){var s=this;return s.hasStructure()?"dynamic-content":"static-content"},hasStructure:function(){var s=this;return !!s.getById("structureId").val()},hasTemplate:function(){var s=this;var t=s.getPrincipalForm();return !!s.getByName(t,"templateId").val()},helperIntersecting:function(){var s=this;s._helper.removeClass("not-intersecting")},helperNotIntersecting:function(t){var s=this;s._helper.addClass("not-intersecting")},hideEditContainerMessage:function(){var t=this;var s=t._getNamespacedId("journalMessage");l.one(s).hide()},loadDefaultStructure:function(){var s=this;var v=s.getPrincipalForm();var u=s.getByName(v,"structureId");var t=s.getByName(v,"templateId");var w=s.getByName(v,"content");u.val("");t.val("");w.val("");v.submit()},loadEditFieldOptions:function(t){var D=this;var F=D.getFieldInstance(t);var v=function(G,H){var K=G.get("id");var J=l.one("#"+K+"Checkbox");var I=l.DataType.Boolean.parse(H);G.val(I);if(J){J.set("checked",I)}};if(F){var C=D.getById("#journalArticleEditFieldWrapper");var B=D.getById("displayAsTooltip");var E=D.getById("repeatable");var y=D.getById("fieldType");var x=D.getById("indexType");var w=D.getById("instructions");var A=D.getById("predefinedValue");var z=D.getById("required");var u=D.getById("fieldLabel");y.val(F.get("fieldType"));x.val(F.get("indexType"));v(B,F.get("displayAsTooltip"));v(E,F.get("repeatable"));v(z,F.get("required"));u.val(F.get("fieldLabel"));w.val(F.get("instructions"));A.val(F.get("predefinedValue"));var s=C.all("input[type=text], select:not([name$=fieldType]), textarea, input[type=checkbox]");if(F.get("repeated")||F.get("parentStructureId")){s.attr("disabled","disabled")}else{s.attr("disabled","")}}},normalizeValue:function(t){var s=this;if(g.isUndefined(t)){t=""}return t},openPopupWindow:function(t,u){var s=window.open(t,u,"directories=no,height=640,location=no,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no,width=680");s.focus()},openSaveStructureDialog:function(){var s=this;var x=s.getPrincipalForm();var t=s.getByName(x,"structureId");var u=s.getByName(x,"structureName");var w=s.getByName(x,"structureDescription");var v=t.val();s.getSaveDialog(function(z){var y=z.fields;y.contentXSD=s.getStructureXSD();y.dialogStructureName.val(u.val());y.dialogDescription.val(w.val());y.dialogStructureId.attr("disabled","disabled").val(y.autoGenerateIdMessage);if(v){y.saveStructureAutogenerateId.hide();y.dialogStructureId.val(t.val())}z.show();z._setAlignCenter(true)})},previewArticle:function(){var C=this;var t=C.getPrincipalForm();var x=C.getPrincipalForm("fm2");var E=C.getArticleContentXML();if(C.structureChange()){if(confirm(Liferay.Language.get("you-should-save-the-structure-first"))){C.openSaveStructureDialog()}}else{var D=C.getByName(t,"languageId");var B=C.getByName(t,"type");var u=C.getByName(t,"version");var A=C.getByName(t,"structureId");var v=C.getByName(t,"templateId");var s=themeDisplay.getPathMain()+"/journal/view_article_content?cmd=preview&groupId="+C.getGroupId()+"&articleId="+C.articleId+"&version="+u.val()+"&languageId="+D.val()+"&type="+B.val()+"&structureId="+A.val()+"&templateId="+v.val();x.attr("action",s);x.attr("target","_blank");var w=C.getByName(t,"title");var z=C.getByName(x,"title",true);var y=C.getByName(x,"xml",true);z.val(w.val());y.val(E);x.submit()}},renderEditFieldOptions:function(v){var t=this;var u=t.getEditButton(v);var s=t.getFields();t.editContainerNormalMode();s.removeClass("selected");v.addClass("selected");if(t._lastEditContainerTrigger!=u){t.editContainerContextPanel.set("trigger",u);t.editContainerContextPanel.show();t._lastEditContainerTrigger=u}t.hideEditContainerMessage();t.loadEditFieldOptions(v);t.editContainerContextPanel.refreshAlign()},repeatField:function(u){var s=this;var w=function(B,E){var z=s.getFieldInstance(B).clone();var D=h();E.addClass("repeated-field");E.removeClass("yui-dd-drop yui-dd-draggable");var A=E.resetId().get("id");j.add(A,z);z.set("source",E);z.set("instanceId",D);var x=z.get("fieldType");if(x=="text_area"){var C=s.buildHTMLEditor(z);z.set("innerHTML",C);var y=E.one(".journal-article-component-container");y.html(C)}else{if(x=="image"){E.all(".journal-image-show-hide,.journal-image-preview").remove()}}return z};var v=u.clone();u.placeAfter(v);w(u,v);var t=v.all(".structure-field");t.each(function(y){var x=w(y,y)});s._attachEvents()},repositionEditFieldOptions:function(){var t=this;var u=t.getById("#journalArticleEditFieldWrapper");var s=!u.ancestor(".aui-overlaycontextpanel-hidden");if(s){setTimeout(function(){var v=t.getSelectedField();t.renderEditFieldOptions(v)},200)}},saveArticle:function(u){var C=this;var t=C.getPrincipalForm();if(C.structureChange()){if(confirm(Liferay.Language.get("you-should-save-the-structure-first"))){C.openSaveStructureDialog()}}else{if(C.hasStructure()&&!C.hasTemplate()){var B=Liferay.Language.get("please-add-a-template-to-render-this-structure");alert(B);C.showMessage("#selectTemplateMessage","info",B,30000);C.getById("selectTemplateBtn").focus()}else{if(!u){u=C.articleId?"update":"add"}var x=C.getByName(t,"cmd");var v=C.getByName(t,"newArticleId");var A=C.getByName(t,"articleId");var z=C.getByName(t,"content");var w=C.getByName(t,"workflowAction");var s=C.validateRequiredFields();if(s){if(u=="publish"){w.val(Liferay.Workflow.ACTION_PUBLISH);u=C.articleId?"update":"add"}x.val(u);if(!C.articleId){A.val(v.val())}C._updateLocaleCheckboxes();var y=C.getArticleContentXML();z.val(y);t.submit()}}}},saveEditFieldOptions:function(s){var G=this;var I=G.getFieldInstance(s);if(I){var F=G.getById("displayAsTooltip");var B=G.getById("displayAsTooltipCheckbox");var H=G.getById("repeatable");var t=G.getById("repeatableCheckbox");var A=G.getById("fieldType");var y=G.getById("indexType");var x=G.getById("instructions");var E=G.getById("predefinedValue");var D=G.getById("required");var w=G.getById("requiredCheckbox");var u=G.getById("fieldLabel");var z=s.one(".journal-article-localized");var v="";if(z){v=z.val()}var C=G.getById("journalMessage");l.each({displayAsTooltip:B.attr("checked"),fieldType:A.val(),indexType:y.val(),instructions:x.val(),localizedValue:v,predefinedValue:E.val(),repeatable:t.attr("checked"),required:w.attr("checked")},function(K,J,L){I.set(J,K)});G.updateFieldLabelName(I,u.val());G.showMessage(C,"success",Liferay.Language.get("your-request-processed-successfully"));G.editContainerNormalMode()}},showMessage:function(t,x,y,u){var s=this;var v=l.one(t);var w="save-structure-message portlet-msg-"+(x||"success");v.attr("className",w);v.show();s.editContainerContextPanel.refreshAlign();if(y){v.html(y)}s.timers[t]=l.later(u||5000,s,function(){v.hide();s.editContainerContextPanel.refreshAlign()})},structureChange:function(w){var s=this;var v=s.getPrincipalForm();var t=s.getByName(v,"structureXSD").val();var u=(t!=encodeURIComponent(s.getStructureXSD()));return u},unselectFields:function(){var s=this;var t=s.getSelectedField();if(t){t.removeClass("selected")}},updateFieldLabelName:function(t,v){var s=this;var u=s.getRepeatedSiblings(t);u.each(function(x,w,z){var y=s.getFieldInstance(x);y.set("fieldLabel",v)});t.set("fieldLabel",v)},updateFieldVariableName:function(t,v){var s=this;var u=s.getRepeatedSiblings(t);u.each(function(x,w,z){var y=s.getFieldInstance(x);y.set("variableName",v)});t.set("variableName",v)},updateStructure:function(s,v,t,y,x,A){var z=this;var u=z.getGroupId();var w=["long","java.lang.String","java.lang.String","java.lang.String","java.lang.String","java.lang.String","com.liferay.portal.service.ServiceContext"];Liferay.Service.Journal.JournalStructure.updateStructure({groupId:u,structureId:v,parentStructureId:s||"",name:t,description:y,xsd:x,serviceContext:l.JSON.stringify({scopeGroupId:u}),serviceParameterTypes:l.JSON.stringify(w)},function(B){if(g.isFunction(A)){A(B)}})},updateTextAreaVisibility:function(t){var s=this;var u=s.getTextAreaFields();if(u){u.setStyle("visibility",t)}},validateRequiredFields:function(){var t=this;var w=true;var y=t._getNamespacedId("#structureTree");var s=l.all(y+" li");var v=s.filter("[dataRequired=true]");var u=l.all(y+" li .field-container");var x=null;u.removeClass("required-field");l.each(v,function(C,A,E){var z=t.getFieldInstance(C);var B=z.getContent(C);if(!B){var D=C.one(".field-container");D.addClass("required-field");if(w){x=t.getPrincipalFieldElement(C)}w=false}});if(x){x.focus()}return w},_appendStructureChildren:function(x,v,u){var t=this;var s="> span.folder > ul > li";if(!u){s+=".structure-field:not(.repeated-field)"}var w=x.all(s).filter(":not(.parent-structure-field)");l.each(w,function(z,y,A){t._appendStructureTypeElementAndMetaData(z,v,u)})},_appendStructureTypeElementAndMetaData:function(H,L,F){var Q=this;var N=Q.getFieldInstance(H);if(N){var J;var x=N.get("fieldType");var A=N.get("indexType");if(F){var P=N.get("instanceId");if(!P){P=h();N.set("instanceId",P)}J=Q._createDynamicNode("dynamic-element",{"instance-id":P,name:encodeURI(N.get("variableName")),type:x,"index-type":A})}else{J=Q._createDynamicNode("dynamic-element",{name:encodeURI(N.get("variableName")),type:x,"index-type":A,repeatable:N.get("repeatable")})}var y=null;if(N.get("localized")){y={"language-id":N.get("localizedValue")}}var I=Q.getNodeTypeContent();var B=Q._createDynamicNode(I,y);var E=Q._createDynamicNode("meta-data");var u=Q._createDynamicNode("entry",{name:"instructions"});var z=Q._createDynamicNode("entry",{name:"required"});var G=Q._createDynamicNode("entry",{name:"displayAsTooltip"});var C=Q._createDynamicNode("entry",{name:"label"});var v=Q._createDynamicNode("entry",{name:"predefinedValue"});L.push(J.openTag);if(!F){Q._appendStructureFieldOptionsBuffer(H,L)}Q._appendStructureChildren(H,L,F);if(!F){L.push(E.openTag);var D=Q.normalizeValue(N.get("displayAsTooltip"));L.push(G.openTag);L.push("<![CDATA["+D+"]]>");L.push(G.closeTag);var w=Q.normalizeValue(N.get("required"));L.push(z.openTag);L.push("<![CDATA["+w+"]]>");L.push(z.closeTag);var s=Q.normalizeValue(N.get("instructions"));L.push(u.openTag);L.push("<![CDATA["+s+"]]>");L.push(u.closeTag);var M=Q.normalizeValue(N.get("fieldLabel"));L.push(C.openTag);L.push("<![CDATA["+M+"]]>");L.push(C.closeTag);var t=Q.normalizeValue(N.get("predefinedValue"));L.push(v.openTag);L.push("<![CDATA["+t+"]]>");L.push(v.closeTag);L.push(E.closeTag)}else{if(F){L.push(B.openTag);var O=(x=="multi-list"||x=="list");if(O){Q._appendStructureFieldOptionsBuffer(H,L,F)}else{var K=N.getContent(H)||"";L.push("<![CDATA["+K+"]]>")}L.push(B.closeTag)}}L.push(J.closeTag)}},_appendStructureFieldOptionsBuffer:function(x,u,t){var s=this;var v=s.getFieldInstance(x);var w=v.get("fieldType");var y=x.all("> .folder > .field-container > .journal-article-component-container > .journal-list-subfield option");if(y){l.each(y,function(D,B,E){var z=s._formatOptionsKey(D.text());var G=D.val();if(!t){var F=s._createDynamicNode("dynamic-element",{name:z,type:G,repeatable:v.get("repeatable")});u.push(F.openTag+F.closeTag)}else{if(D.get("selected")){var A=(w=="multi-list");var C=s._createDynamicNode("option");if(A){u.push(C.openTag)}u.push("<![CDATA["+G+"]]>");if(A){u.push(C.closeTag)}}}})}},_attachDelegatedEvents:function(){var t=this;var z=t._getNamespacedId("#journalArticleContainer");var x=function(A){var E=A.currentTarget;var D=E.get("parentNode");var F=D.get("parentNode").one("select");var B=D.one("input.journal-list-key");var H=t._formatOptionsKey(B.val());var I=D.one("input.journal-list-value");var G=I.val();if(H&&G){var J=F.all("option");J.each(function(N,M,O){var K=g.trim(H);var L=g.trim(N.text());if(L.toLowerCase()==K.toLowerCase()){N.remove()}});var C=l.Node.create(m).val(G).text(H);F.append(C);C.attr("selected","selected");B.val("").focus();I.val("value")}else{B.focus()}};var v=function(B){var A=B.currentTarget.get("parentNode").one("span.journal-add-field");if(B.keyCode==13){B.currentTarget=A;x.apply(B.currentTarget,arguments)}};var y=function(D){var C=D.currentTarget;var A=C.get("parentNode").one("select").focus();var B=A.all("option");B.each(function(F,E,G){if(F.attr("selected")){F.remove()}})};var u=l.one(z);u.delegate("click",function(A){var C=A.currentTarget;var B=t.getSourceByNode(C);t._updateLocaleState(B,C)},".journal-article-localized-checkbox .aui-field-input-choice");u.delegate("click",function(A){var B=t.getSourceByNode(A.currentTarget);t.repeatField(B)},".repeatable-field-add");u.delegate("click",function(A){var B=t.getSourceByNode(A.currentTarget);t.closeField(B)},".repeatable-field-delete");u.delegate("mouseenter",function(A){var B=t.getSourceByNode(A.currentTarget);B.addClass("repeatable-border")},".repeatable-field-image");u.delegate("mouseleave",function(A){var B=t.getSourceByNode(A.currentTarget);B.removeClass("repeatable-border")},".repeatable-field-image");u.delegate("keypress",v,".journal-list-key");u.delegate("keypress",v,".journal-list-value");u.delegate("click",x,".journal-add-field");u.delegate("click",y,".journal-delete-field");u.delegate("click",function(E){var C=E.currentTarget;var A=null;var B=C.ancestor(".journal-image-preview");var D=B.one(".journal-image-wrapper");var F=t.getByName(B,"journalImageDelete");if(F.val()==""){F.val("delete");D.hide();A=Liferay.Language.get("cancel")}else{F.val("");D.show();A=Liferay.Language.get("delete")}C.val(A)},'[name="'+t.portletNamespace+'journalImageDeleteButton"]');u.delegate("click",function(E){var D=E.currentTarget;var A=D.get("parentNode").get("parentNode").one(".journal-image-preview");var B=D.one(".show-label").show();var C=D.one(".hide-label").show();var F=A.hasClass("aui-helper-hidden");if(F){B.hide();C.show()}else{B.show();C.hide()}A.toggle()},".journal-image-link");var w=function(D,C,A){var B=".journal-"+D+"-button .aui-button-input";u.delegate("click",function(H){var F=H.currentTarget;var E=F.ancestor(".journal-article-component-container").one(".aui-field-input");var G=F.attr("data-"+D+"Url");window[t.portletNamespace+A]=function(I){E.val(I)};t.openPopupWindow(G,C)},B)};w("documentlibrary","DocumentLibrary","selectDocumentLibrary");w("imagegallery","ImageGallery","selectImageGallery");u.delegate("mouseover",function(C){var E=C.currentTarget;var D=t.getSourceByNode(E);var B=t.getFieldInstance(D);if(B){var A=B.get("instructions");Liferay.Portal.ToolTip.show(this,A)}},"img.journal-article-instructions-container");var s='[name="'+t.portletNamespace+'variableName"]';u.delegate("keypress",l.bind(t._onKeypressVariableName,t),s);u.delegate("keyup",l.bind(t._onKeyupVariableName,t),s)},_attachEditContainerEvents:function(v){var E=this;var D=E.getById("#journalArticleEditFieldWrapper");var B=D.all("input[type=checkbox]");var s=D.all("input[type=text],select");var y=D.all("textarea");var C=D.one(".cancel-button .aui-button-input");var z=D.one(".close-button .aui-button-input");var u=D.one(".save-button .aui-button-input");var x=E.getById("enableLocalizationCheckbox");var w=E.getById("languageIdSelect");var t=E.getById("journalArticleWrapper");B.detach("click");s.detach("change");s.detach("keypress");y.detach("change");y.detach("keypress");C.detach("click");z.detach("click");u.detach("click");var A=E.editContainerSaveMode;B.on("click",A,E);s.on("change",A,E);s.on("keypress",A,E);y.on("change",A,E);y.on("keypress",A,E);u.on("click",function(){var G=E.getSelectedField();E.saveEditFieldOptions(G)});var F=E.closeEditFieldOptions;C.on("click",F,E);z.on("click",F,E);x.on("click",function(H){var G=x.get("checked");t.toggleClass("localization-disabled",!G);l.io.request(themeDisplay.getPathMain()+"/portal/session_click",{data:{liferay_journal_localization:G}})})},_attachEvents:function(){var I=this;var G=I.getCloseButtons();var F=I.getEditButtons();var E=I.getRepeatableButtons();var x=I.getById("defaultLanguageIdSelect");var s=I.getById("downloadArticleContentBtn");var D=I.getById("journalArticleContainer");var w=I.getById("languageIdSelect");var J=I.getById("previewArticleBtn");var v=I.getById("publishButton");var t=I.getById("saveButton");var u=D.all(".journal-article-component-container .aui-field-input");G.detach("click");u.detach("change");x.detach("change");F.detach("click");w.detach("change");E.detach("click");if(v){v.detach("click")}if(t){t.detach("click")}F.on("click",function(L){var M=I.getSourceByNode(L.currentTarget);I.renderEditFieldOptions(M)});E.on("click",function(L){var M=I.getSourceByNode(L.currentTarget);I.repeatField(M)});G.on("click",function(L){var M=I.getSourceByNode(L.currentTarget);I.closeField(M)});if(t){t.on("click",function(){I.saveArticle()})}if(v){v.on("click",function(){I.saveArticle("publish")})}if(s){s.detach("click");s.on("click",function(){I.downloadArticleContent()})}if(J){J.detach("click");J.on("click",function(){I.previewArticle()})}w.on("change",function(){I.changeLanguageView()});x.on("change",function(){I.changeLanguageView()});var C=I.getById("changeStructureBtn");var B=I.getById("changeTemplateBtn");var z=I.getById("editStructureBtn");var y=I.getById("loadDefaultStructure");var H=I.getById("saveStructureBtn");var K=l.one(".journal-save-structure-trigger");C.detach("click");z.detach("click");H.detach("click");K.detach("click");C.on("click",function(M){if(confirm(Liferay.Language.get("selecting-a-new-structure-will-change-the-available-input-fields-and-available-templates"))){var L=M.target.attr("dataChangeStructureUrl");I.openPopupWindow(L,"ChangeStructure")}});if(B){B.detach("click");B.on("click",function(M){if(confirm(Liferay.Language.get("selecting-a-template-will-change-the-structure,-available-input-fields,-and-available-templates"))){var L=M.target.attr("dataChangeTemplateUrl");I.openPopupWindow(L,"ChangeTemplate")}})}if(y){y.detach("click");y.on("click",function(){I.loadDefaultStructure()})}H.on("click",function(){I.openSaveStructureDialog()});K.on("click",function(L){L.preventDefault();H.simulate("click")});var A=l.getBody();z.on("click",function(L){if(A.hasClass("portlet-journal-edit-mode")){I.disableEditMode()}else{I.enableEditMode()}});u.on("change",function(){window[I.portletNamespace+"contentChanged"]()})},_createDynamicNode:function(x,t){var s=this;var u=[];var w=[];if(!x){x="dynamic-element"}var v=["<",x,(t?" ":""),,">",,"</",x,">"];l.each(t||{},function(z,y,A){if(z!==undefined){u.push([y,'="',z,'" '].join(""))}});v[3]=u.join("").replace(/[\s]+$/g,"");w=v.join("").replace(/></,">><<").replace(/ +>/,">").split(/></);return{closeTag:w[1],openTag:w[0]}},_createFieldHTMLTemplate:function(v){var s=this;var w=v.getFieldContainer();var t=v.getFieldElementContainer();var x=v.get("innerHTML");var u=v.get("fieldType");t.html(x);return w.html()},_dropField:function(){var s=this;s.repositionEditFieldOptions()},_emptyFunction:function(){return""},_fieldInstanceFactory:function(v){var s=this;var w;if(g.isString(v)){w=v;v=null}else{w=v.fieldType}v=v||{};var u={"boolean":a.FieldModel.Boolean,document_library:a.FieldModel.DocumentLibrary,image:a.FieldModel.Image,image_gallery:a.FieldModel.ImageGallery,link_to_layout:a.FieldModel.LinkToPage,list:a.FieldModel.List,"multi-list":a.FieldModel.MultiList,selection_break:a.FieldModel.SelectionBreak,text:a.FieldModel.Text,text_area:a.FieldModel.TextArea,text_box:a.FieldModel.TextBox};v=l.merge(u[w],v);var t=new a.StructureField(v,s.portletNamespace).render();t.get("fieldLabel");return t},_formatOptionsKey:function(t){return t.replace(/\W+/g," ").replace(/^\W+|\W+$/g,"").replace(/ /g,"_")},_getNamespacedId:function(v,t,u){var s=this;if(!g.isString(t)){t=s.portletNamespace}if(!g.isString(u)){u="#"}v=v.replace(/^#/,"");return u+t+v},_initializePageLoadFieldInstances:function(){var t=this;var s=t.getFields();s.each(function(L,z,F){var J=t.getFieldInstance(L);if(!J){var C=L.attr("dataName");var H=L.attr("dataType");var E=L.attr("dataDisplayAsTooltip");var u=L.attr("dataLabel");var x=L.attr("dataIndexType");var K=L.attr("dataInstanceId");var v=L.attr("dataInstructions");var A=L.one(".journal-article-localized");var D=L.attr("dataParentStructureId");var w=L.attr("dataPredefinedValue");var y=L.attr("dataRepeatable");var B=L.attr("dataRequired");if(A){var M=A.val()}var I=(String(M)!="false");J=t._fieldInstanceFactory({displayAsTooltip:E,fieldLabel:u,instanceId:K,instructions:v,localized:I,localizedValue:M,parentStructureId:D,predefinedValue:w,repeatable:y,required:B,source:L,fieldType:H,indexType:x,variableName:C})}var G=L.get("id");j.add(G,J)})},_initializeTagsSuggestionContent:function(){var s=this;window[s.portletNamespace+"getSuggestionsContent"]=function(){var t=[];s.getFields().each(function(w,v,y){var u=s.getFieldInstance(w);var x=u.getContent(w);t.push(x)});return t.join(" ")}},_onKeyupVariableName:function(v){var s=this;var u=v.currentTarget;var w=s.getSourceByNode(u);var t=s.getFieldInstance(w);if(t){var x=u.val();s.updateFieldVariableName(t,x)}},_onKeypressVariableName:function(v){var s=this;var y=[8,37,39,46];var t=v.charCode;var x=v.keyCode;if((l.Array.indexOf(y,x)!=-1)){return}var u=/^[\w_-]$/;var w=String.fromCharCode(x);if(!u.test(w)){v.halt()}},_stripComponentType:function(s){return s.toLowerCase().replace(/[^a-z]+/g,"")},_translateErrorMessage:function(t){var s="";if(t.indexOf("StructureXsdException")>-1){s=Liferay.Language.get("please-enter-a-valid-xsd")}else{if(t.indexOf("DuplicateStructureIdException")>-1){s=Liferay.Language.get("please-enter-a-unique-id")}else{if(t.indexOf("StructureDescriptionException")>-1){s=Liferay.Language.get("please-enter-a-valid-description")}else{if(t.indexOf("StructureIdException")>-1){s=Liferay.Language.get("please-enter-a-valid-id")}else{if(t.indexOf("StructureInheritanceException")>-1){s=Liferay.Language.get("this-structure-is-already-within-the-inheritance-path-of-the-selected-parent-please-select-another-parent-structure")}else{if(t.indexOf("StructureNameException")>-1){s=Liferay.Language.get("please-enter-a-valid-name")}else{if(t.indexOf("NoSuchStructureException")>-1){s=Liferay.Language.get("please-enter-a-valid-id")}else{if(t.indexOf("ArticleContentException")>-1){s=Liferay.Language.get("please-enter-valid-content")}else{if(t.indexOf("ArticleIdException")>-1){s=Liferay.Language.get("please-enter-a-valid-id")}else{if(t.indexOf("ArticleTitleException")>-1){s=Liferay.Language.get("please-enter-a-valid-name")}else{if(t.indexOf("DuplicateArticleIdException")>-1){s=Liferay.Language.get("please-enter-a-unique-id")}}}}}}}}}}}return s},_updateLocaleCheckboxes:function(){var t=this;var s=t.getFields();s.each(function(v,u,x){var w=v.one(".journal-article-localized-checkbox .aui-field-input-choice");if(w&&w.get("checked")){t._updateLocaleState(v,w)}})},_updateLocaleState:function(s,x){var z=this;var u=x.get("checked");var B=z.getFieldInstance(s);var t=z.getById("languageIdSelect");var A=z.getDefaultLocale();var v=s.one(".journal-article-localized");var y=A;if(t){y=t.val()}var w=function(C){if(v){v.val(C)}};if(u){w(y)}else{if(!confirm(Liferay.Language.get("unchecking-this-field-will-remove-localized-data-for-languages-not-shown-in-this-view"))){x.attr("checked",true);w(y)}else{w(false)}}var B=z.getFieldInstance(s);B.set("localized",x.get("checked"))},_updateOriginalStructureXSD:function(){var s=this;var u=s.getPrincipalForm();var v=encodeURIComponent(s.getStructureXSD());var t=s.getByName(u,"structureXSD");t.val(v)}};var f=l.Component.create({ATTRS:{content:{validator:g.isString,value:""},displayAsTooltip:{setter:function(t){var s=this;return s.setAttribute("displayAsTooltip",i.Boolean.parse(t))},valueFn:function(){var s=this;return s.getAttribute("displayAsTooltip",true)}},fieldLabel:{setter:function(t){var s=this;return s.setFieldLabel(t)},valueFn:function(){var s=this;return s.getAttribute("fieldLabel","")}},fieldType:{setter:function(t){var s=this;return s.setAttribute("fieldType",t)},validator:g.isString,value:""},localized:{valueFn:function(){var s=this;var t=s.getLocalizedValue();return(String(t)=="true")}},localizedValue:{getter:function(){var s=this;return s.getLocalizedValue()}},indexType:{setter:function(t){var s=this;return s.setAttribute("IndexType",t)},valueFn:function(){var s=this;return s.getAttribute("IndexType","")}},innerHTML:{validator:g.isString,value:o},instructions:{setter:function(t){var s=this;return s.setInstructions(t)},valueFn:function(){var s=this;return s.getAttribute("instructions","")}},instanceId:{setter:function(t){var s=this;return s.setInstanceId(t)},valueFn:function(){var s=this;var t=h();return s.getAttribute("instanceId",t)}},optionsEditable:{validator:g.isBoolean,value:true},parentStructureId:{setter:function(t){var s=this;return s.setAttribute("parentStructureId",t)},valueFn:function(){var s=this;return s.getAttribute("parentStructureId","")}},predefinedValue:{setter:function(t){var s=this;return s.setAttribute("predefinedValue",t)},valueFn:function(){var s=this;return s.getAttribute("predefinedValue","")}},repeatable:{setter:function(t){var s=this;return s.setRepeatable(i.Boolean.parse(t))},valueFn:function(){var s=this;return s.getAttribute("repeatable",false)}},repeated:{getter:function(){var s=this;return s.get("source").hasClass("repeated-field")}},required:{setter:function(t){var s=this;return s.setAttribute("required",i.Boolean.parse(t))},valueFn:function(){var s=this;return s.getAttribute("required",false)}},source:{value:null},variableName:{setter:function(t){var s=this;return s.setVariableName(t)},validator:g.isString,valueFn:function(){var s=this;return s.getAttribute("name")}}},EXTENDS:l.Widget,NAME:"structurefield",constructor:function(t,u){var s=this;s._lazyAddAttrs=false;s.portletNamespace=u;f.superclass.constructor.apply(this,arguments)},UI_ATTRS:["optionsEditable"],prototype:{cloneableAttrs:["displayAsTooltip","fieldLabel","fieldType","indexType","innerHTML","instructions","localized","localizedValue","predefinedValue","repeatable","required","variableName"],initializer:function(){var t=this;var s=t.propagateAttr;l.each(t.cloneableAttrs,function(v,u,w){t.after(v+"Change",s)})},canDrop:function(){var s=this;return a.prototype.canDrop.apply(s,arguments)},clone:function(){var s=this;var t={};var u=s.portletNamespace;l.each(s.cloneableAttrs,function(w,v,x){t[w]=s.get(w)});t.source=null;return new f(t,u)},createInstructionsContainer:function(s){return l.Node.create(e).html(s)},createTooltipImage:function(){return l.Node.create(c)},getAttribute:function(u,t){var s=this;var w=undefined;var v=s.get("source");if(v){w=v.attr("data"+u)}if(g.isUndefined(w)&&!g.isUndefined(t)){w=t}return w},getByName:function(){var s=this;return a.prototype.getByName.apply(s,arguments)},getComponentType:function(){var s=this;return a.prototype.getComponentType.apply(s,arguments)},getContent:function(s){var C=this;var y;var z=C.get("fieldType");var u=s.one("div.journal-article-component-container");var w=u.one(".aui-field-input");if(z=="boolean"){y=w.attr("checked")}else{if(z=="text_area"){var v=s.one("iframe").attr("name");var A=window[v];if(A&&g.isFunction(A.getHTML)){y=A.getHTML()}}else{if(z=="multi-list"){var t=[];var D=w.all("option");D.each(function(F,E,H){if(F.get("selected")){var G=F.val();t.push(G)}});y=t.join(",")}else{if(z=="image"){var B=u.one(".journal-image-content");var x=C.getByName(u,"journalImageDelete");if(x&&x.val()=="delete"){y="delete"}else{if(B){y=B.val()||w.val()}}}else{if(w){y=w.val()}}}}}C.set("content",y);return y},getFieldContainer:function(){var H=this;if(!H.fieldContainer){var B=[];var t=Liferay.Language.get("field");var A=Liferay.Language.get("localized");var u=Liferay.Language.get("this-field-is-required");var I=Liferay.Language.get("variable-name");var C=H.get("optionsEditable");var F=H.getById("editBtnTemplate");var w="";if(F){w=F.html()}var G="";if(!C){G="aui-helper-hidden"}var y=H.getById("repeatableBtnTemplate");var E="";if(y){E=y.html()}var x=H.get("fieldType");var z=H.get("required");var D=H.get("variableName")+k();var v=h();B=l.substitute(q,{articleButtonsRowCSSClass:G,editBtnTemplateHTML:w,fieldLabel:t,localizedLabelLanguage:A,instanceId:v,portletNamespace:H.portletNamespace,repeatableBtnTemplateHTML:E,requiredFieldLanguage:u,variableName:D,variableNameLanguage:I});H.fieldContainer=l.Node.create(B);var s=H.fieldContainer.one("li");s.setAttribute("dataName",D);s.setAttribute("dataRequired",z);s.setAttribute("dataType",x);s.setAttribute("dataInstanceId",v);if(!H.canDrop(s)){H.fieldContainer.one(".folder-droppable").remove()}}return H.fieldContainer},getFieldElementContainer:function(){var s=this;if(!s.fieldElementContainer){s.fieldElementContainer=s.getFieldContainer().one("div.journal-article-component-container")}return s.fieldElementContainer},getFieldInstance:function(){var s=this;return a.prototype.getFieldInstance.apply(s,arguments)},getFieldLabelElement:function(){var s=this;var t=s.get("source");if(!t){t=s.getFieldContainer().one("li")}return t.one("> .folder > .field-container .journal-article-field-label")},getLocalizedValue:function(){var s=this;var u=s.get("source");if(u){var t=u.one(".journal-article-localized")}return t?t.val():"false"},getRepeatedSiblings:function(){var s=this;return a.prototype.getRepeatedSiblings.apply(s,[s])},propagateAttr:function(t){var s=this;var u=s.getRepeatedSiblings();if(u){u.each(function(x,w,y){var v=s.getFieldInstance(x);if(v){v.set(t.attrName,t.newVal)}})}},setFieldLabel:function(u){var s=this;var t=s.getFieldLabelElement();if(!u){u=s.get("variableName")}t.one("span").html(u);s.setAttribute("fieldLabel",u);return u},setInstanceId:function(x){var s=this;s.setAttribute("instanceId",x);var u=s.get("fieldType");var w=s.get("source");if((u=="image")&&w){var v=s.get("localized");var y="structure_image_"+x+"_"+s.get("variableName");var t=w.one(".journal-article-component-container [type=file]");if(v){y+="_"+s.get("localizedValue")}t.attr("name",y)}return x},setInstructions:function(A){var B=this;var s=B.get("source");if(s){var C=B.getFieldInstance(s);B.setAttribute("instructions",A);if(C){var u=s.one("> .folder > .field-container");var y=C.getFieldLabelElement();var t=y.one(".journal-article-instructions-container");var v=u.one(".journal-article-instructions-message");var z=C.get("displayAsTooltip");if(t){t.remove()}if(v){v.remove()}if(A){if(!z){var w=C.createInstructionsContainer(A);var x=u.one(".journal-article-required-message");x.placeAfter(w)}else{y.append(C.createTooltipImage())}}}}return A},setRepeatable:function(w){var x=this;var s=x.get("source");x.setAttribute("repeatable",w);if(s){var A=x.getFieldInstance(s);var v=s.one("> .folder > .field-container");var u=v.one(".repeatable-field-image");var y=s.one(".journal-article-buttons .repeatable-button");if(u){u.remove()}var t=x.get("parentStructureId");if(w&&!t){var z=l.Node.create(l.one("#repeatable-field-image-model").html());v.append(z);if(y){y.show()}}else{if(y){y.hide()}}}return w},setVariableName:function(v){var s=this;var u=s.getFieldLabelElement();var t=u.get("parentNode").one(".journal-article-component-container .aui-field-input");if(t){t.attr("id",v);u.setAttribute("for",v)}s.setAttribute("name",v);return v},setAttribute:function(t,v){var s=this;var u=s.get("source");if(g.isArray(v)){v=v[0]}if(u){u.setAttribute("data"+t,v)}return v},_uiSetOptionsEditable:function(v){var s=this;var u=s.get("source");if(u){var t=u.one(".journal-article-buttons");if(t){if(v){t.show()}else{t.hide()}}}},_getNamespacedId:a.prototype._getNamespacedId,getById:a.prototype.getById}});a.StructureField=f;a.FieldModel={};var p=a.FieldModel;var d=function(w,v,x,u){var t=this;var s=l.one('#journalFieldModelContainer div[dataType="'+v+'"]');if(s){var y=s.html()}p[w]={fieldLabel:x,fieldType:v,innerHTML:y,optionsEditable:u,variableName:x}};d("Text","text","TextField",true);d("TextArea","text_area","TextAreaField",true);d("TextBox","text_box","TextBoxField",true);d("Image","image","ImageField",true);d("ImageGallery","image_gallery","ImageGalleryField",true);d("DocumentLibrary","document_library","DocumentLibraryField",true);d("Boolean","boolean","BooleanField",true);d("List","list","ListField",true);d("MultiList","multi-list","MultiListField",true);d("LinkToPage","link_to_layout","LinkToPageField",true);d("SelectionBreak","selection_break","SelectionBreakField",false);Liferay.Portlet.Journal=a},"",{requires:["aui-base","aui-data-set","aui-datatype","aui-dialog","aui-nested-list","aui-overlay-context-panel","json","substitute"]});