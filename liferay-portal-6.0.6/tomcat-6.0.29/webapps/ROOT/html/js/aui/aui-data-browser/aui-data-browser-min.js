AUI.add("aui-data-browser",function(J){var r=J.Lang,O=r.isArray,G=r.isString,f=r.isNull,K=r.isFunction,m=J.ClassNameManager.getClassName,Y="databrowser",c="bindUI",W="icon",H="search",g="circle-triangle-r",S="folder-open",E="image",V="renderUI",R="search",k="text",e="tree",T=Y+"-"+R+"control",D=Y+"-"+e+"control",l=function(s){for(var A in s){if(s[A].children||(s[A].leaf!=undefined&&!s[A].leaf)){l(s[A].children);}else{s[A].cssClass=(s[A].cssClass?" ":"")+n;}}},U=function(A){return A.hasClass(n);},C=function(A){return(A instanceof J.TreeView);},n=m(Y,"results","item"),Q=m(Y,R),a=m(Y,R,"list"),L=m(Y,R,"list","item"),i=m(Y,R,"view","only"),B=m(Y,e),j=m(e,"node","leaf"),P=m(Y,e,"view","only"),F='<div class="'+Q+'"></div>',q='<ul class="'+a+'"></ul>',b='<li class="'+n+" "+L+'-{1}">{0}</li>',N='<img src="{2}" title="{1}" alt="" /><div>{0}</div>',M='<span class="{2}" title="{1}"></span><div>{0}</div>',Z='<div title="{1}">{0}</div>',d='<div class="'+B+'"></div>';var X=function(){var A=this;J.after(A._renderUISearchBrowserView,A,V);J.after(A._bindUISearchBrowserView,A,c);};X.ATTRS={displayName:{value:false},matchKey:{value:""}};X.prototype={_renderUISearchBrowserView:function(){var A=this;var s=J.Node.create(F);A.get("contentBox").append(s);A._viewNode=s;},_bindUISearchBrowserView:function(){var A=this;A.on("handleResponse",A._populateResultView,A);},hideView:function(){var A=this;A._viewNode.hide();},showView:function(){var A=this;A._viewNode.show();},_populateResultView:function(AB){var AG=this;var s=AB.response;var y=AG.doBeforeLoadData(AB);if(y&&!AB.error){AG.fire("dataReturn",AB);var AD=s.results;var u=AG.get("displayName");var v=AG.get("matchKey");var A=[];if(v){var x=[];var AH=[];var w=0;for(var AC=0;AC<AD.length;AC++){var AK=AD[AC][v];if(AK!=null){if(x[AK]!=null){A[x[AK]].data.push(AD[AC]);}else{x[AK]=w;A[w]={name:AK,data:[AD[AC]]};w++;}}else{AH.push(AD[AC]);}}A.sort(function(AM,AL){return(AM.data.length==AL.data.length?0:(AM.data.length>AL.data.length?-1:1));});if(AH.length>0){A.push({name:"",data:AH});}}else{A.push({name:"",data:AD});}AG._viewNode.html("");for(var AC=0;AC<A.length;AC++){var z=J.Node.create(q);for(var AA=0;AA<A[AC].data.length;AA++){var AI=A[AC].data[AA];var AJ;var AE;var t;if(AI.imageUri){AJ=N;AE=AI.imageUri;t=E;}else{if(AI.iconCss){AJ=M;AE=AI.iconCss;t=W;}else{AJ=Z;t=k;}}AJ=r.sub(b,[r.sub(AJ,[(u?AI.name:""),AI.title||"",AE||""]),t]);var AF=J.Node.create(AJ);AF.setData(Y,AI);z.append(AF);}if(v){new J.Panel({collapsible:true,collapsed:(AG._viewNode.html()!=""),headerContent:A[AC].name,bodyContent:z}).render(AG._viewNode);}else{AG._viewNode.append(z);}}}},_uiSetHeight:function(v){var s=this;var A=parseInt(v);var t=s._viewNode;if(A){var u=t.getBorderWidth("tb")+t.getPadding("tb");t.setStyle("height",(A-u));}else{t.setStyle("height","");}}};var o=J.Base.build(T,J.Component,[J.DataSourceControl,J.InputTextControl,X]);var p=function(){var A=this;J.after(A._renderUITreeBrowserView,A,V);J.after(A._bindUITreeBrowserView,A,c);};p.ATTRS={rootLabel:{value:""}};p.prototype={_renderUITreeBrowserView:function(){var A=this;var t=A.get("contentBox");var v=A.get("dataSource");var s=J.Node.create(d);t.append(s);var u=new J.TreeView().render(s);u.on("expand",function(y){var w=this;var x=y.tree.node;w._expandNode(x,v);},A);A._treeView=u;A._viewNode=s;},_bindUITreeBrowserView:function(){var A=this;A._expandNode(A._treeView,A.get("dataSource"));},doBeforeLoadData:function(A){return true;},hideView:function(){var A=this;A._viewNode.hide();},showView:function(){var A=this;A._viewNode.show();},_expandNode:function(t,u){var A=this;if(t&&!t.hasChildNodes()){var s={cfg:(!C(t)?t._originalConfig:null),callback:{success:function(v){A._populateResultView(J.mix(v,{node:t}));}}};A.fire("dataRequest",{request:s});u.sendRequest(s);}},_populateResultView:function(y){var s=this;var v=y.response;var x=y.node;var w=s.doBeforeLoadData(y);if(w&&!y.error&&x){s.fire("dataReturn",y);var A=v.results;if(A.length>0){var t=s.get("rootLabel");if(t&&C(x)){var u=new J.TreeNode({label:t,children:A});x.appendChild(u);}else{J.each(A,function(z){var AA=x.createNode.apply(s,[z]);x.appendChild(AA);});}}}else{s.fire("dataError",y);}},_uiSetHeight:function(v){var s=this;var A=parseInt(v);var t=s._viewNode;if(A){var u=t.getBorderWidth("tb")+t.getPadding("tb");t.setStyle("height",(A-u));}else{t.setStyle("height","");}}};var I=J.Base.build(D,J.Component,[J.DataSourceControl,p]);var h=J.Component.create({NAME:Y,ATTRS:{currentView:{value:R},searchView:{value:null},treeView:{value:null}},prototype:{renderUI:function(){var A=this;var s=A.get("contentBox");var y=A.get("searchView");var u=A.get("treeView");if(y){var t=new o(J.mix({iconButton:g},y)).render(s);A._searchBrowser=t;}else{s.addClass(P);}if(u){var x=new I(u).render(s);A._treeBrowser=x;}else{s.addClass(i);}if(y&&u){var w=A._searchBrowser.comboBox;var v=new J.Toolbar({children:[{icon:H,handler:{fn:function(){var z=this;z.set("currentView",R);z._updateViews();},context:A}},{icon:S,handler:{fn:function(){var z=this;z.set("currentView",e);z._updateViews();},context:A}}]}).render(w.get("boundingBox"));}},bindUI:function(){var A=this;A.get("contentBox").delegate("click",function(t){var s=t.currentTarget;var u;if(U(s)){u=s.getData(Y);}else{s=J.Widget.getByNode(s);if(s){u=s._originalConfig;}}if(u){A.fire("itemSelected",{item:u,node:s});}else{A.fire("itemError",t);}},"."+n+", ."+j);},syncUI:function(){var A=this;A._updateViews();A._syncDimensions();},_syncDimensions:function(){var w=this;var y=w.get("height");if(y){var s=w.get("boundingBox");var v=w._searchBrowser;var A=w._treeBrowser;var t=0;if(v){var u=v.comboBox;if(u){var x=u.get("boundingBox");t+=x.getBorderWidth("tb")+x.getMargin("tb")+x.get("offsetHeight");}}var z=parseInt(w.get("height"),10)-t;if(v){v.set("height",z);}if(A){A.set("height",z);}}},_updateViews:function(){var A=this;var u=A.get("currentView");var s=A._searchBrowser;var t=A._treeBrowser;if(s&&t){if(u==R){t.hideView();s.showView();}else{if(u==e){s.hideView();t.showView();
}}}}}});J.DataBrowser=h;},"1.0.1",{skinnable:true,requires:["aui-base","aui-datasource-control-base","aui-input-text-control","aui-tree","aui-panel"]});