AUI.add("aui-scheduler-event",function(aF){var am=aF.Lang,bh=am.isString,h=am.isDate,a5=am.isFunction,P=am.isObject,a8=am.isBoolean,aa=am.isNumber,aW=aF.ColorUtil,n=aF.DataType.DateMath,a2=aF.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bd="-",z="&ndash;",av=".",u="",v=" ",r="_",aJ="_propagateSet",U="activeView",aD="borderStyle",bp="borderWidth",Q="Change",a1="color",aS="colorBrightnessFactor",bb="colorSaturationFactor",aB="content",ag="contentNode",B="disabled",aZ="duration",aM="endDate",bi="events",aq="hidden",ap="icon",Y="icons",a0="id",aU="isoTime",bo="locale",s="node",k="overlay",aH="parentEvent",bs="recorder",aK="repeat",bg="repeated",a6="repeater",T="repeatedEvents",af="scheduler",at="scheduler-event",au="scheduler-event-recorder",bk="startDate",a4="template",aR="title",g="titleDateFormat",N="titleNode",an="visible",f="%H:%M",a3="%I:%M",L=aF.ClassNameManager.getClassName,o=L(ap),w=L(at),aN=L(at,aB),G=L(at,aq),bf=L(at,B),ao=L(at,bs),ax=L(at,bg),al=L(at,a6),I=L(at,aR),bn=L(at,Y);CSS_SCHEDULER_EVENT_ICON_DISABLED=L(at,ap,B),CSS_SCHEDULER_EVENT_ICON_REPEATED=L(at,ap,bg),CSS_SCHEDULER_EVENT_ICON_REPEATER=L(at,ap,a6);var V=aF.Component.create({NAME:at,ATTRS:{borderStyle:{value:"solid",validator:bh},borderWidth:{value:"1px",validator:bh},colorBrightnessFactor:{value:0.75,validator:aa},colorSaturationFactor:{value:1.5,validator:aa},content:{value:"(no title)",validator:bh},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bh},titleDateFormat:{getter:"_getTitleDateFormat",validator:bh},endDate:{valueFn:function(){var A=n.clone(this.get(bk));A.setHours(A.getHours()+1);return A;},validator:h},columnNode:{setter:aF.one},disabled:{value:false,validator:a8},node:{valueFn:function(){return aF.Node.create(this.EVENT_NODE_TEMPLATE).setData(at,this);},setter:aF.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:h},visible:{value:true,validator:a8}},EXTENDS:aF.Base,PROPAGATE_ATTRS:[bk,aM,aB,a1,aS,bb,aD,bp,g,an,B],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+w+'">'+'<div class="'+I+'"></div>'+'<div class="'+aN+'"></div>'+'<div class="'+bn+'">'+'<span class="'+[o,CSS_SCHEDULER_EVENT_ICON_REPEATED].join(v)+'"></span>'+'<span class="'+[o,CSS_SCHEDULER_EVENT_ICON_REPEATER].join(v)+'"></span>'+'<span class="'+[o,CSS_SCHEDULER_EVENT_ICON_DISABLED].join(v)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var bu=A.get(s);A.eventStack={};A.nodeStack={};aF.Array.each(aF.SchedulerEvent.PROPAGATE_ATTRS,function(bv){A.after(bv+Q,A._propagateAttrChange);});A._bindUIAttrs();A.contentNode=bu.one(av+aN);A.titleNode=bu.one(av+I);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(bu,bv){bu.destroy();});A.eventStack={};A.get(s).remove(true);},copyDates:function(bu){var A=this;A.set(aM,n.clone(bu.get(aM)));A.set(bk,n.clone(bu.get(bk)));},copyPropagateAttrValues:function(bu,bv){var A=this;A.copyDates(bu);aF.Array.each(aF.SchedulerEvent.PROPAGATE_ATTRS,function(bw){if(!(bw in (bv||{}))){var bx=bu.get(bw);if(!P(bx)){A.set(bw,bx);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return n.getDayOffset(A.get(aM),A.get(bk));},getHoursDuration:function(){var A=this;return n.getHoursOffset(A.get(aM),A.get(bk));},getMinutesDuration:function(){var A=this;return n.getMinutesOffset(A.get(aM),A.get(bk));},getSecondsDuration:function(){var A=this;return n.getSecondsOffset(A.get(aM),A.get(bk));},sameEndDate:function(bu){var A=this;return n.compare(A.get(aM),bu.get(aM));},sameStartDate:function(bu){var A=this;return n.compare(A.get(bk),bu.get(bk));},isAfter:function(bw){var bv=this;var bu=bv.get(bk);var A=bw.get(bk);return n.after(bu,A);},isBefore:function(bw){var bv=this;var bu=bv.get(bk);var A=bw.get(bk);return n.before(bu,A);},repeatByDate:function(bv){var A=this;var bw=A.uidByDate(bv);if(!A.eventStack[bw]){var bu=n.clone(bv);var bx=n.clone(bv);n.copyHours(bu,A.get(bk));n.copyHours(bx,A.get(aM));var by=new aF.SchedulerEvent({endDate:bx,parentEvent:A,scheduler:A.get(af),startDate:bu});by.copyPropagateAttrValues(A);A.eventStack[bw]=by;}return A.eventStack[bw];},intersects:function(bw){var bv=this;var bx=bv.get(aM);var bu=bv.get(bk);var A=bw.get(bk);return(bv.sameStartDate(bw)||n.between(A,bu,bx));},intersectHours:function(bv){var bu=this;var bx=bu.get(aM);var A=bu.get(bk);var bw=n.clone(A);n.copyHours(bw,bv.get(bk));return(n.compare(A,bw)||n.between(bw,A,bx));},isDayOverlapEvent:function(){var A=this;return n.isDayOverlap(A.get(bk),A.get(aM));},isRepeatableDate:function(bu){var A=this;var bv=A.get(aK);return(bv&&bv.validate(A,bu));},getClearEndDate:function(){var A=this;return n.safeClearTime(A.get(aM));},getClearStartDate:function(){var A=this;return n.safeClearTime(A.get(bk));},uidByDate:function(bu){var A=this;bu=h(bu)?n.safeClearTime(bu):A.getClearStartDate();return[at,bu.getTime()].join(r);},setContent:function(bv,bu){var A=this;A._setContent(ag,bv,bu);},setTitle:function(bv,bu){var A=this;A._setContent(N,bv,bu);},syncNodeUI:function(bu){var A=this;A._syncUIAttrs();A.syncNodeColorUI(bu);A.syncNodeTitleUI(bu);A.syncNodeContentUI(bu);},syncNodeColorUI:function(bu){var A=this;var bv=A.get(s);var bw=A.getBorderColor();if(bv){bv.setStyles({borderWidth:A.get(bp),borderColor:bw,backgroundColor:A.get(a1),borderStyle:A.get(aD)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:bw});}if(bu){A.eachRepeatedEvent(function(bx,by){bx.syncNodeColorUI();});}},syncNodeContentUI:function(bu){var A=this;A.setContent(A.get(aB),bu);},syncNodeTitleUI:function(bu){var A=this;var bv=A._formatDate(A.get(bk));var bw=A._formatDate(A.get(aM));A.setTitle([bv,bw].join(v+z+v),bu);},eachRepeatedEvent:function(bu){var A=this;aF.each(A.eventStack,bu,A);},unlink:function(){var A=this;if(A.get(aH)){A.set(aH,null);}else{A.eachRepeatedEvent(function(bu,bv){bu.unlink();});}A.eventStack={};A.syncNodeUI();
},_afterDisabledChange:function(bu){var A=this;A._uiSetDisabled(bu.newVal);},_afterVisibleChange:function(bu){var A=this;A._uiSetVisible(bu.newVal);},_afterRepeatChange:function(bu){var A=this;A._uiSetRepeat(bu.newVal);},_afterParentEventChange:function(bu){var A=this;A._uiSetParentEvent(bu.newVal);},_bindUIAttrs:function(){var A=this;A.after("disabledChange",A._afterDisabledChange);A.after("visibleChange",A._afterVisibleChange);A.after("parentEventChange",A._afterParentEventChange);A.after("repeatChange",A._afterRepeatChange);A._syncUIAttrs();},_propagateAttrChange:function(bw){var A=this;var bv=bw.attrName;var bu=bw.newVal;A.eachRepeatedEvent(function(bx,by){var bz=bx[aJ+a2(bv)];if(bz){bz.apply(A,[bx,bv,bu]);}else{bx.set(bv,bw.newVal);}bx.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,bu,bw){var bv=n.clone(A.get(aM));n.copyHours(bv,bw);A.set(aM,bv);},_propagateSetStartDate:function(bu,bv,bw){var A=n.clone(bu.get(bk));n.copyHours(A,bw);bu.set(bk,A);},_setColor:function(bu){var A=this;A.hsbColor=aW.rgb2hsb(aW.getRGB(bu));A.borderColor=aF.clone(A.hsbColor);A.borderColor.b*=A.get(aS);A.borderColor.s*=A.get(bb);A.borderColorRGB=aW.hsb2rgb(A.borderColor);return bu;},_setContent:function(bv,bx,bu){var A=this;var bw=A[bv];if(bw){bw.setContent(bx);}if(bu){A.eachRepeatedEvent(function(by,bz){by[bv].setContent(bx);});}},_setRepeat:function(bu){var A=this;if(bh(bu)){bu=aF.SchedulerEventRepeat[bu];}return P(bu)?bu:null;},_setScheduler:function(bv){var A=this;var bu=A.get(af);if(bu){A.removeTarget(bu);}A.addTarget(bv);return bv;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(B));A._uiSetVisible(A.get(an));A._uiSetParentEvent(A.get(aH));A._uiSetRepeat(A.get(aK));},_formatDate:function(bv,bw){var bu=this;var A=bu.get(bo);bw=bw||bu.get(g);return aF.DataType.Date.format(bv,{format:bw,locale:A});},_getTitleDateFormat:function(bv){var A=this;if(!bh(bv)){var bu=A.get(af);bv=(bu&&bu.get(U).get(aU))?f:a3;}return bv;},_uiSetDisabled:function(bu){var A=this;A.get(s).toggleClass(bf,!!bu);},_uiSetParentEvent:function(bu){var A=this;A.get(s).toggleClass(ax,!!bu);},_uiSetRepeat:function(bu){var A=this;A.get(s).toggleClass(al,!!bu);},_uiSetVisible:function(bu){var A=this;A.get(s).toggleClass(G,!bu);}}});aF.SchedulerEvent=V;aF.SchedulerEventRepeat={daily:{description:"Every day",validate:function(A,bu){return true;},value:"daily"},monthly:{description:"Every month",validate:function(bu,bv){var bw=bu.get(aM);var A=bu.get(bk);return(A.getDate()===bv.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,bu){return n.isMonWedOrFri(bu);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,bu){return n.isTueOrThu(bu);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,bu){return n.isWeekDay(bu);},value:"weekDays"},weekly:{description:"Every week",validate:function(bu,bv){var bw=bu.get(aM);var A=bu.get(bk);return(A.getDay()===bv.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(bu,bv){var bw=bu.get(aM);var A=bu.get(bk);return((A.getMonth()===bv.getMonth())&&(A.getDay()===bv.getDay()));},value:"yearly"}};var U="activeView",bm="bc",bl="bd",aw="bodyContent",t="boundingBox",aG="button",e="column",aB="content",aC="dateFormat",az="dblclick",aY="desc",ay="disk",br="event",a7="field",aI="fieldset",aA="form",ah="hint",ak="input",aU="isoTime",aL="label",x="layout",aQ="menu",J="overlayContextPanel",p="pencil",aK="repeat",q="row",af="scheduler",Z="select",S="strings",a="tc",M="text",X="when",j="trigger",ai="auiSchedulerEventRecorderWhen",bc="auiSchedulerEventRecorderDesc",aX="auiSchedulerEventRecorderSelect",H="auiSchedulerEventRecorderButtonRow",ae="cancel",E="edit",aE="save",bd="-",K="#",bt=L(at,bs,k),ba=L(at,bs,aA),y=L(aA),l=L(x,aB),be=L(x,aI),ar=L(x,aI,bl),ad=L(x,aI,aB),F=L(x,"w100"),m=L(e),aO=L(e,aB),b=L(a7),C=L(a7,aQ),aP=L(a7,Z),bj=L(a7,aB),d=L(a7,aL),aV=L(a7,M),i=L(aG,q),a9=L(a7,ak),aj=L(a7,ak,Z),D=L(a7,ak,M),aT=L(at,bs,aL,X),c=L(at,bs,aY),R=L(at,bs,a7,ah),ac=L(at,bs,aK),ab=L(at,bs,aG,q),O="<option></option>",bq='<form id="auiSchedulerEventRecorderForm" class="'+[ba,l,y].join(v)+'">'+'<div class="'+[be,F,m].join(v)+'">'+'<div class="'+[ad,aO].join(v)+'aui-fieldset-content aui-column-content">'+'<div class="'+ar+'">'+'<span class="'+[b,aV].join(v)+'">'+'<span class="'+bj+'">'+'<label class="'+d+'">{when}:</label>'+'<span id="auiSchedulerEventRecorderWhen" class="'+aT+'"></span>'+"</span>"+"</span>"+'<span class="'+[b,aV].join(v)+'">'+'<span class="'+bj+'">'+'<label class="'+d+'" for="auiSchedulerEventRecorderDesc">{description}</label>'+'<input id="auiSchedulerEventRecorderDesc" class="'+[a9,D,c].join(v)+'" size="30" type="text" />'+'<div class="'+R+'">'+"<span>{description-hint}</span>"+"</div>"+"</span>"+"</span>"+'<span class="'+[b,C,aP].join(v)+'">'+'<label class="'+d+'" for="auiSchedulerEventRecorderSelect">{repeat}:</label>'+'<select id="auiSchedulerEventRecorderSelect" class="'+[a9,aj,ac].join(v)+'">'+'<option selected="selected" value="">{no-repeat}</option>'+"</select>"+"</span>"+'<div id="auiSchedulerEventRecorderButtonRow" class="'+[b,i,ab].join(v)+'"></div>'+"</div>"+"</div>"+"</div>"+"</form>";var W=aF.Component.create({NAME:au,ATTRS:{content:{value:u},duration:{value:60},dateFormat:{value:"%a, %B %d,",validator:bh},event:{},strings:{value:{},setter:function(A){return aF.merge({save:"Save",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",when:"When","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat"},A||{});},validator:P},overlayContextPanel:{value:{},setter:function(bu){var A=this;var bv=aF.Node.create(aF.substitute(bq,A.get(S)));return aF.merge({align:{points:[bm,a]},anim:false,bodyContent:bv,hideOn:az,trigger:A.get(s),visible:false,zIndex:9999},bu||{});}}},EXTENDS:aF.SchedulerEvent,prototype:{initializer:function(){var A=this;A._createEvents();A.after("schedulerChange",A._afterSchedulerChange);A.on("startDateChange",A._onStartDateChange);
A.get(s).addClass(ao);},showOverlay:function(){var A=this;if(!A.overlay){A._initOverlay();}A.overlay.render().show();},getEventCopy:function(bu){var A=this;var bw=A.overlayDescNode.val();var bv=A.get(br);if(!bv){bv=new aF.SchedulerEvent({endDate:A.get(aM),scheduler:A.get(af),startDate:A.get(bk)});bv.copyPropagateAttrValues(A,{content:true});}bv.set(aK,A.overlaySelectNode.val());if(bw){bv.set(aB,bw);}return bv;},hideOverlay:function(){var A=this;if(A.overlay){A.overlay.hide();}},loadFormValues:function(){var A=this;var bw=u;var bv=u;var bu=A.get(br);if(bu){var bx=bu.get(aK);if(bx){bw=bx.value;}bv=bu.get(aB);}A.overlaySelectNode.val(bw);A.overlayWhenNode.setContent(A._getWhenFormattedDt());setTimeout(function(){A.overlayDescNode.val(bv).selectText();},0);},_afterSchedulerChange:function(bw){var A=this;var bv=bw.newVal;var bu=bv.get(t);bu.delegate("click",aF.bind(A._onClickSchedulerEvent,A),av+w);},_createEvents:function(){var A=this;var bu=function(bv,bw){A.publish(bv,{defaultFn:bw,queuable:false,emitFacade:true,bubbles:true});};bu(aE,this._defSaveEventFn);bu(E,this._defEditEventFn);bu(ae,this._defCancelEventFn);},_initOverlay:function(){var bu=this;var A=bu.get(S);bu.overlay=new aF.OverlayContextPanel(bu.get(J));var bw=bu.overlay;var bv=bw.get(t);var bx=bw.get(aw);bu.overlayButtonRowNode=bx.one(K+H);bu.overlayDescNode=bx.one(K+bc);bu.overlaySelectNode=bx.one(K+aX);bu.overlayWhenNode=bx.one(K+ai);bu.overlaySaveBtn=new aF.ButtonItem({label:A.save,icon:ay,render:bu.overlayButtonRowNode,handler:{fn:bu._handleSaveEvent,context:bu}});bu.overlayEditBtn=new aF.ButtonItem({label:A.edit,icon:p,render:bu.overlayButtonRowNode,handler:{fn:bu._handleEditEvent,context:bu}});bu.overlayCancelBtn=new aF.ButtonItem({label:A.cancel,render:bu.overlayButtonRowNode,handler:{fn:bu._handleCancelEvent,context:bu}});aF.each(aF.SchedulerEventRepeat,function(bz,by){bu.overlaySelectNode.append(aF.Node.create(O).val(bz.value||by).setContent(bz.description));});bw.on("hide",aF.bind(bu._onOverlayHide,bu));bw.on("show",aF.bind(bu._onOverlayShow,bu));bx.on("submit",aF.bind(bu._onSubmitForm,bu));bv.addClass(bt);},_defCancelEventFn:function(bu){var A=this;A.hideOverlay();},_defEditEventFn:function(bv){var A=this;var bu=A.get(af);A.hideOverlay();bu.syncEventsUI();},_defSaveEventFn:function(bv){var A=this;var bu=A.get(af);bu.addEvent(bv.newSchedulerEvent);A.hideOverlay();bu.syncEventsUI();},_getWhenFormattedDt:function(){var bv=this;var bu=bv.get(aC);var bx=(bv.get(br)||bv);var bz=bx.get(aM);var by=bx.get(af);var A=bx.get(bk);var bw=(by.get(U).get(aU)?n.toIsoTimeString:n.toUsTimeString);return[bx._formatDate(A,bu),bw(A),bd,bw(bz)].join(v);},_handleEditEvent:function(bu){var A=this;A.fire(E,{newSchedulerEvent:A.getEventCopy()});bu.preventDefault();},_handleSaveEvent:function(bu){var A=this;A.fire(aE,{newSchedulerEvent:A.getEventCopy()});bu.preventDefault();},_handleCancelEvent:function(bu){var A=this;A.fire(ae);bu.preventDefault();},_onClickSchedulerEvent:function(bv){var A=this;var bu=bv.currentTarget.getData(at);if(bu){if(!A.overlay){A._initOverlay();}A.set(br,bu);A.overlay.set(j,bu.get(s));A.get(s).remove();A.showOverlay();}},_onOverlayHide:function(bv){var A=this;var bu=A.get(s);if(A.overlay){A.set(br,null);A.overlay.set(j,bu);}bu.remove();},_onOverlayShow:function(bv){var bu=this;var bw=bu.overlayEditBtn;var A=bu.overlaySaveBtn;if(bu.get(br)){bw.show();A.hide();}else{bw.hide();A.show();}bu.loadFormValues();},_onStartDateChange:function(bu){var A=this;var bv=A.get(aZ);A.set(aM,n.add(bu.newVal,n.MINUTES,bv));},_onSubmitForm:function(bu){var A=this;if(A.get(br)){A._handleEditEvent(bu);}else{A._handleSaveEvent(bu);}}}});aF.SchedulerEventRecorder=W;},"1.0.1",{requires:["aui-base","aui-color-util","aui-datatype","aui-overlay-context-panel","substitute"],skinnable:true});