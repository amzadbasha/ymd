AUI.add("aui-drawing-animate",function(P){var F=P.Lang,B=F.isFunction,M=F.isString,e=P.ColorUtil,N=P.Drawing,S=N.Element,Y=N.Set,H=N.Util,E=S.prototype,O=N.MAP_ATTRS_AVAILABLE,L=Math,T=L.abs,a=L.max,W=L.min,I=L.pow,Q=L.round,d=/^(from|to|\d+%)$/,Z=/^cubic-bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,J=N.REGEX_SEPARATOR,R=N.STR_EMPTY,C=N.STR_SPACE,G="number",K={along:"along",blur:G,"clip-rect":"csv",cx:G,cy:G,fill:"color","fill-opacity":G,"font-size":G,height:G,opacity:G,path:"path",r:G,rotation:"csv",rx:G,ry:G,scale:"csv",stroke:"color","stroke-opacity":G,"stroke-width":G,translation:"csv",width:G,x:G,y:G};var c=N.Animation={};c.easing_formulas={linear:function(A){return A;},"<":function(A){return I(A,3);},">":function(A){return I(A-1,3)+1;},"<>":function(A){A=A*2;if(A<1){return I(A,3)/2;}A-=2;return(I(A,3)+2)/2;},backIn:function(f){var A=1.70158;return f*f*((A+1)*f-A);},backOut:function(f){f=f-1;var A=1.70158;return f*f*((A+1)*f+A)+1;},elastic:function(g){if(g==0||g==1){return g;}var f=0.3;var A=f/4;return I(2,-10*g)*L.sin((g-A)*(2*L.PI)/f)+1;},bounce:function(h){var f=7.5625;var g=2.75;var A;if(h<(1/g)){A=f*h*h;}else{if(h<(2/g)){h-=(1.5/g);A=f*h*h+0.75;}else{if(h<(2.5/g)){h-=(2.25/g);A=f*h*h+0.9375;}else{h-=(2.625/g);A=f*h*h+0.984375;}}}return A;}};var X=[];c.elements=X;c.animation=function(){var o=+new Date;for(var AB=0;AB<X.length;AB++){if(AB!="length"&&X.hasOwnProperty(AB)){var AG=X[AB];if(AG.stop||AG.el.removed){continue;}var k=o-AG.start;var w=AG.ms;var v=AG.easing;var AC=AG.from;var s=AG.diff;var f=AG.to;var r=AG.t;var n=AG.el;var u={};var A;if(k<w){var h=v(k/w);for(var z in AC){if(AC.hasOwnProperty(z)){switch(K[z]){case"along":A=h*w*s[z];f.back&&(A=f.len-A);var AA=getPointAtLength(f[z],A);n.translate(s.sx-s.x||0,s.sy-s.y||0);s.x=AA.x;s.y=AA.y;n.translate(AA.x-s.sx,AA.y-s.sy);f.rot&&n.rotate(s.r+AA.alpha,AA.x,AA.y);break;case G:A=+AC[z]+h*w*s[z];break;case"color":A="rgb("+[b(Q(AC[z].r+h*w*s[z].r)),b(Q(AC[z].g+h*w*s[z].g)),b(Q(AC[z].b+h*w*s[z].b))].join(",")+")";break;case"path":A=[];for(var AE=0,g=AC[z].length;AE<g;AE++){A[AE]=[AC[z][AE][0]];for(var AD=1,AF=AC[z][AE].length;AD<AF;AD++){A[AE][AD]=+AC[z][AE][AD]+h*w*s[z][AE][AD];}A[AE]=A[AE].join(C);}A=A.join(C);break;case"csv":switch(z){case"translation":var q=h*w*s[z][0]-r.x;var p=h*w*s[z][1]-r.y;r.x+=q;r.y+=p;A=q+C+p;break;case"rotation":A=+AC[z][0]+h*w*s[z][0];AC[z][1]&&(A+=","+AC[z][1]+","+AC[z][2]);break;case"scale":A=[+AC[z][0]+h*w*s[z][0],+AC[z][1]+h*w*s[z][1],(2 in f[z]?f[z][2]:R),(3 in f[z]?f[z][3]:R)].join(C);break;case"clip-rect":A=[];AE=4;while(AE--){A[AE]=+AC[z][AE]+h*w*s[z][AE];}break;}break;default:var m=[].concat(AC[z]);var A=[];AE=n.paper.customAttributes[z].length;while(AE--){A[AE]=+AC[AE]+h*w*s[z][AE];}break;}u[z]=A;}}n.attr(u);n._run&&n._run.call(n);}else{if(f.along){AA=getPointAtLength(f.along,f.len*!f.back);n.translate(s.sx-(s.x||0)+AA.x-s.sx,s.sy-(s.y||0)+AA.y-s.sy);f.rot&&n.rotate(s.r+AA.alpha,AA.x,AA.y);}if(r.x||r.y){n.translate(-r.x,-r.y);}if(f.scale){f.scale+=R;}n.attr(f);X.splice(AB--,1);}}}if(P.UA.svg&&n&&n.paper){n.paper.safari();}if(X.length){setTimeout(c.animation);}};var V=function(f,A){return f.key-A.key;};var U=function(A,f,j,g,h){var i=j-g;f.timeouts.push(setTimeout(function(){if(B(h)){h.call(f);}f.animate(A,i,A.easing);},g));};var b=function(A){return a(W(A,255),0);};function D(r,h,f,q,p,l){var m=3*h;var o=3*(q-h)-m;var A=1-m-o;var k=3*f;var n=3*(p-f)-k;var s=1-k-n;function j(u){return((A*u+o)*u+m)*u;}function g(u,w){var v=i(u,w);return((s*v+n)*v+k)*v;}function i(t,AB){var AA,z,w,u,y,v;for(w=t,v=0;v<8;v++){u=j(w)-t;if(T(u)<AB){return w;}y=(3*A*w+2*o)*w+m;if(T(y)<0.000001){break;}w=w-u/y;}AA=0;z=1;w=t;if(w<AA){return AA;}if(w>z){return z;}while(AA<z){u=j(w);if(T(u-t)<AB){return w;}if(t>u){AA=w;}else{z=w;}w=(z-AA)/2+AA;}return w;}return g(r,1/(200*l));}E.animateWith=function(g,j,A,l,k){for(var f=0,h=X.length;f<h;f++){if(X[f].el.id==g.id){j.start=X[f].start;}}return this.animate(j,A,l,k);};c.along=function(A){return function(h,g,f,j){var i={back:A};B(f)?(j=f):(i.rot=f);h&&h.constructor==S&&(h=h.attrs.path);h&&(i.along=h);return this.animate(i,g,j);};};E.animateAlong=c.along();E.animateAlongBack=c.along(1);E.onAnimation=function(g){var A=this;A._run=g||0;return A;};E.animate=function(AI,y,x,l){var AH=this;AH.timeouts=AH.timeouts||[];if(B(x)||!x){l=x||null;}if(AH.removed){l&&l.call(AH);return AH;}var AC={};var f={};var q={};var p=false;var v=AH.paper.customAttributes;for(var z in AI){if(AI.hasOwnProperty(z)){if(K.hasOwnProperty(z)||v.hasOwnProperty(z)){p=true;AC[z]=AH.attr(z);if(AC[z]==null){AC[z]=O[z];}f[z]=AI[z];switch(K[z]){case"along":var AF=getTotalLength(AI[z]);var AA=getPointAtLength(AI[z],AF*!!AI.back);var m=AH.getRegion();q[z]=AF/y;q.tx=m.x;q.ty=m.y;q.sx=AA.x;q.sy=AA.y;f.rot=AI.rot;f.back=AI.back;f.len=AF;if(AI.rot){q.r=parseFloat(AH.rotate())||0;}break;case G:q[z]=(f[z]-AC[z])/y;break;case"color":AC[z]=e.getRGB(AC[z]);var AB=e.getRGB(f[z]);q[z]={r:(AB.r-AC[z].r)/y,g:(AB.g-AC[z].g)/y,b:(AB.b-AC[z].b)/y};break;case"path":var n=H.path2curve(AC[z],f[z]);AC[z]=n[0];var t=n[1];q[z]=[];for(var AE=0,h=AC[z].length;AE<h;AE++){q[z][AE]=[0];for(var AD=1,AG=AC[z][AE].length;AD<AG;AD++){q[z][AE][AD]=(t[AE][AD]-AC[z][AE][AD])/y;}}break;case"csv":var A=String(AI[z]).split(J);var o=String(AC[z]).split(J);switch(z){case"translation":AC[z]=[0,0];q[z]=[A[0]/y,A[1]/y];break;case"rotation":AC[z]=(o[1]==A[1]&&o[2]==A[2])?o:[0,A[1],A[2]];q[z]=[(A[0]-AC[z][0])/y,0,0];break;case"scale":AI[z]=A;AC[z]=String(AC[z]).split(J);q[z]=[(A[0]-AC[z][0])/y,(A[1]-AC[z][1])/y,0,0];break;case"clip-rect":AC[z]=String(AC[z]).split(J);q[z]=[];AE=4;while(AE--){q[z][AE]=(A[AE]-AC[z][AE])/y;}break;}f[z]=A;break;default:A=[].concat(AI[z]);o=[].concat(AC[z]);q[z]=[];AE=v[z].length;while(AE--){q[z][AE]=((A[AE]||0)-(o[AE]||0))/y;}break;}}}}if(!p){var w=[];var k;for(var AJ in AI){if(AI.hasOwnProperty(AJ)&&d.test(AJ)){z={value:AI[AJ]};if(AJ=="from"){AJ=0;}else{if(AJ=="to"){AJ=100;}}z.key=parseInt(AJ,10);w.push(z);}}w.sort(V);if(w[0].key){w.unshift({key:0,value:AH.attrs});
}var u;var g=w.length;for(var AE=0;AE<g;AE++){z=w[AE];u=w[AE-1];U(z.value,AH,y/100*z.key,y/100*(u&&u.key||0),u&&u.value.callback);}k=w[g-1].value.callback;if(k){AH.timeouts.push(setTimeout(function(){k.call(AH);},y));}}else{var r=c.easing_formulas[x];if(!r){r=String(r).match(Z);if(r&&r.length==5){var s=r;r=function(i){return D(i,+s[1],+s[2],+s[3],+s[4],y);};}else{r=function(i){return i;};}}X.push({start:AI.start||+new Date,ms:y,easing:r,from:AC,diff:q,to:f,el:AH,t:{x:0,y:0}});if(B(l)){AH._ac=setTimeout(function(){l.call(AH);},y);}if(X.length==1){setTimeout(c.animation);}}return AH;};E.stop=function(){var A=this;for(var f=0;f<X.length;f++){if(X[f].el.id==A.id){X.splice(f--,1);}}A.timeouts=[];clearTimeout(A._ac);delete A._ac;return A;};E.translate=function(A,f){return this.attr({translation:A+" "+f});};Y.addMethod(["animateAlong","animateAlongBack","animateWith","onAnimation","stop","translate"]);Y.prototype.animate=function(g,A,k,o){var n=this;if(B(k)||!k){o=k||null;}var l=n._items;var f=l.length;var h=f;var p;var m;var j;if(o){j=function(){if(!--f){o.call(n);}};}k=M(k)?k:j;p=l[--h].animate(g,A,k,j);while(h--){m=l[h];if(m&&!m.removed){m.animateWith(p,g,A,k,j);}}return n;};},"1.0.1",{requires:["aui-drawing-base"]});